---
title: Middleware
description: How to extend REST API functionality with middleware
---

## Route middleware

Middleware with the REST API are just the usual Express middleware. You may define a list of middleware to run before a route using the `.middleware()` method on a route instance:

```js
const { route } = require('@tensei/core')

route('Download invoices')
    .post()
    .path('users/invoices/downloads')
    .middleware([async (request, response, next) => {
        if (! request.user.invoices) {
            return response.status(401).json({
                message: 'You are not authorized to download invoices.'
            })
        }

        next()
    }])
    .handle((request, response) => request.users.invoices)
```

You may also define middleware on existing routes. To get an existing route, for example those generated by tensei, you may use the `getRoute()` method. A good place to do this would be in the `.register()` hook:

```js
const { tensei } = require('@tensei/core')

tensei()
    .register(({ getRoute }) => {
        getRoute('insert_comments')
            ?.middleware([...])
    })
```

## Global middleware
Since middleware use the underlying express server, you may define middleware directly on the express instance. A good place to do this would be the `.register()` hook:

```js
const { tensei } = require('@tensei/core')
const pino = require('express-pino-logger')()

tensei()
    .register(({ app }) => {
        app.use(pino())
    })
```

